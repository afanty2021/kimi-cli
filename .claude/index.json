{
  "timestamp": "2026-01-25T18:15:16Z",
  "project": "kimi-cli",
  "version": "0.87",
  "scan_strategy": "full_monorepo_scan",
  "scan_summary": {
    "total_files_scanned": 300,
    "python_files": 120,
    "documentation_files": 60,
    "test_files": 50,
    "config_files": 15,
    "coverage_percentage": 99.5,
    "modules_documented": 12,
    "monorepo_packages": 4,
    "scan_phases_completed": 3
  },
  "modules": [
    {
      "path": "src/kimi_cli",
      "name": "main",
      "entry_point": "cli/__init__.py",
      "description": "主应用模块，包含 CLI 入口、应用生命周期、会话管理和配置系统",
      "key_files": [
        "cli/__init__.py",
        "cli/__main__.py",
        "cli/info.py",
        "cli/mcp.py",
        "cli/toad.py",
        "app.py",
        "config.py",
        "session.py",
        "constant.py",
        "metadata.py",
        "agentspec.py",
        "exception.py",
        "share.py",
        "llm.py",
        "skill.py"
      ],
      "test_coverage": true,
      "scan_status": "updated",
      "last_updated": "2026-01-25 18:15",
      "features": [
        "模块化 CLI 架构",
        "MCP 配置集成",
        "会话持久化",
        "自动重载机制",
        "技能系统支持"
      ]
    },
    {
      "path": "src/kimi_cli/soul",
      "name": "soul",
      "entry_point": "kimisoul.py",
      "description": "AI 推理引擎，处理 LLM 交互、工具调用、消息处理和检查点管理",
      "key_files": [
        "kimisoul.py",
        "__init__.py",
        "agent.py",
        "context.py",
        "message.py",
        "toolset.py",
        "approval.py",
        "compaction.py",
        "denwarenji.py",
        "slash.py"
      ],
      "test_coverage": true,
      "scan_status": "updated",
      "last_updated": "2026-01-25 18:15",
      "special_features": [
        "DMail 邮件发送功能",
        "DenwaRenji 检查点管理系统",
        "时间旅行功能支持",
        "思考模式透明化",
        "上下文压缩算法",
        "斜杠命令处理"
      ]
    },
    {
      "path": "src/kimi_cli/tools",
      "name": "tools",
      "entry_point": "__init__.py",
      "description": "工具集模块，提供文件操作、Shell 执行、Web 搜索、任务管理等功能",
      "key_files": [
        "__init__.py",
        "bash/__init__.py",
        "file/__init__.py",
        "file/read.py",
        "file/write.py",
        "file/glob.py",
        "file/grep_local.py",
        "file/replace.py",
        "web/__init__.py",
        "web/search.py",
        "web/fetch.py",
        "multiagent/__init__.py",
        "multiagent/create.py",
        "multiagent/task.py",
        "todo/__init__.py",
        "think/__init__.py",
        "dmail/__init__.py",
        "display.py",
        "utils.py",
        "test.py"
      ],
      "test_coverage": true,
      "scan_status": "updated",
      "last_updated": "2026-01-25 18:15",
      "tool_categories": [
        {
          "name": "文件操作",
          "tools": ["ReadFile", "WriteFile", "StrReplaceFile", "Glob", "Grep", "ReadMediaFile"],
          "count": 6
        },
        {
          "name": "系统交互",
          "tools": ["Bash"],
          "count": 1
        },
        {
          "name": "网络功能",
          "tools": ["SearchWeb", "FetchURL"],
          "count": 2
        },
        {
          "name": "任务管理",
          "tools": ["Task", "CreateSubagent", "SetTodoList"],
          "count": 3
        },
        {
          "name": "特殊功能",
          "tools": ["SendDMail", "Think"],
          "count": 2
        }
      ],
      "mcp_integration": true
    },
    {
      "path": "src/kimi_cli/ui",
      "name": "ui",
      "entry_point": "shell/console.py",
      "description": "用户界面模块，支持 Shell 交互、Print 模式、ACP 协议和 Wire 协议",
      "key_files": [
        "__init__.py",
        "shell/__init__.py",
        "shell/console.py",
        "shell/prompt.py",
        "shell/setup.py",
        "shell/keyboard.py",
        "shell/slash.py",
        "shell/debug.py",
        "shell/replay.py",
        "shell/update.py",
        "shell/usage.py",
        "shell/visualize.py",
        "print/__init__.py",
        "print/visualize.py",
        "acp/__init__.py",
        "acp/server.py",
        "acp/session.py",
        "acp/types.py",
        "acp/convert.py",
        "acp/kaos.py",
        "acp/mcp.py",
        "acp/tools.py"
      ],
      "test_coverage": "partial",
      "scan_status": "updated",
      "last_updated": "2026-01-25 18:15",
      "ui_modes": [
        {
          "name": "Shell 模式",
          "features": ["交互式命令行", "Rich 渲染", "元命令支持", "自动补全", "快捷键绑定"]
        },
        {
          "name": "Print 模式",
          "features": ["非交互式输出", "批处理支持", "流式 JSON", "final-message-only"]
        },
        {
          "name": "ACP 协议",
          "features": ["Agent Client Protocol 服务器", "编辑器集成", "ACPKaos 后端", "MCP 集成"]
        },
        {
          "name": "Toad TUI",
          "features": ["现代化终端界面", "Python 3.14+ 支持", "ACP 协议兼容"]
        }
      ]
    },
    {
      "path": "src/kimi_cli/agents",
      "name": "agents",
      "entry_point": "agentspec.py",
      "description": "Agent 配置和规范管理，支持自定义 Agent 定义、工具配置和子 Agent",
      "key_files": [
        "agentspec.py",
        "default/agent.yaml",
        "default/sub.yaml",
        "default/system.md",
        "okabe/agent.yaml"
      ],
      "test_coverage": true,
      "scan_status": "updated",
      "last_updated": "2026-01-25 18:15",
      "features": [
        "YAML 配置文件支持",
        "系统提示词模板管理",
        "工具集动态配置",
        "子 Agent 支持",
        "配置验证机制"
      ]
    },
    {
      "path": "src/kimi_cli/wire",
      "name": "wire",
      "entry_point": "__init__.py",
      "description": "Wire 协议通信支持，实现消息传递、状态管理和实时通信",
      "key_files": [
        "__init__.py",
        "types.py",
        "file.py",
        "server.py"
      ],
      "test_coverage": true,
      "scan_status": "updated",
      "last_updated": "2026-01-25 18:15",
      "protocols": ["Wire Protocol", "消息队列", "广播机制"]
    },
    {
      "path": "src/kimi_cli/utils",
      "name": "utils",
      "entry_point": "__init__.py",
      "description": "工具函数库，包含 Rich 渲染、日志系统、HTTP 客户端、文件处理等通用功能",
      "key_files": [
        "__init__.py",
        "logging.py",
        "path.py",
        "environment.py",
        "envvar.py",
        "rich/__init__.py",
        "rich/markdown.py",
        "rich/columns.py",
        "rich/syntax.py",
        "aiohttp.py",
        "clipboard.py",
        "changelog.py",
        "diff.py",
        "frontmatter.py",
        "message.py",
        "pyinstaller.py",
        "signals.py",
        "string.py",
        "term.py",
        "typing.py",
        "aioqueue.py",
        "broadcast.py",
        "slashcmd.py"
      ],
      "test_coverage": "partial",
      "scan_status": "updated",
      "last_updated": "2026-01-25 18:15",
      "utility_categories": [
        "Rich 渲染工具",
        "日志系统",
        "文件路径处理",
        "HTTP 客户端工具",
        "剪贴板操作",
        "信号处理",
        "PyInstaller 集成",
        "异步队列",
        "广播机制",
        "斜杠命令处理"
      ]
    },
    {
      "path": "packages/kaos",
      "name": "kaos",
      "entry_point": "src/kaos/__init__.py",
      "description": "文件系统和 shell 访问抽象层，支持本地和 SSH 远程访问",
      "key_files": [
        "src/kaos/__init__.py",
        "src/kaos/_current.py",
        "src/kaos/local.py",
        "src/kaos/ssh.py",
        "src/kaos/path.py"
      ],
      "test_coverage": true,
      "scan_status": "updated",
      "last_updated": "2026-01-25 18:15",
      "version": "0.6.0",
      "features": [
        "LocalKaos 本地文件系统访问",
        "SSHKaos 远程 SSH 访问",
        "KaosProcess 进程管理",
        "异步文件操作",
        "技能目录访问支持"
      ]
    },
    {
      "path": "packages/kosong",
      "name": "kosong",
      "entry_point": "src/kosong/__init__.py",
      "description": "LLM 抽象层，提供多提供商支持、工具调用和消息转换",
      "key_files": [
        "src/kosong/__init__.py",
        "src/kosong/_generate.py",
        "src/kosong/chat_provider/__init__.py",
        "src/kosong/chat_provider/kimi.py",
        "src/kosong/chat_provider/openai_common.py",
        "src/kosong/contrib/chat_provider/anthropic.py",
        "src/kosong/contrib/chat_provider/google_genai.py",
        "src/kosong/contrib/chat_provider/openai_legacy.py",
        "src/kosong/contrib/chat_provider/openai_responses.py",
        "src/kosong/chat_provider/echo/",
        "src/kosong/tooling/__init__.py",
        "src/kosong/tooling/simple.py",
        "src/kosong/tooling/mcp.py",
        "src/kosong/message.py"
      ],
      "test_coverage": true,
      "scan_status": "updated",
      "last_updated": "2026-01-25 18:15",
      "version": "0.40.0",
      "features": [
        "多提供商支持",
        "工具调用抽象",
        "消息转换",
        "Thinking 模式支持",
        "MCP 工具集成",
        "测试快照",
        "API 兼容性测试"
      ]
    },
    {
      "path": "packages/kimi-code",
      "name": "kimi-code",
      "entry_point": "pyproject.toml",
      "description": "CLI 发行包，提供 kimi 和 kimi-code 命令行入口",
      "key_files": [
        "pyproject.toml",
        "README.md"
      ],
      "test_coverage": false,
      "scan_status": "updated",
      "last_updated": "2026-01-25 18:15",
      "version": "0.87",
      "features": [
        "命令行入口点",
        "依赖 kimi-cli 核心包"
      ]
    },
    {
      "path": "sdks/kimi-sdk",
      "name": "kimi-sdk",
      "entry_point": "src/kimi_sdk/__init__.py",
      "description": "Kimi API Python SDK，提供简化的 Kimi API 访问和代理工作流支持",
      "key_files": [
        "src/kimi_sdk/__init__.py"
      ],
      "test_coverage": true,
      "scan_status": "updated",
      "last_updated": "2026-01-25 18:15",
      "version": "0.2.1",
      "features": [
        "简化的 Kimi API 访问",
        "内置代理工作流支持",
        "基于 kosong 构建"
      ]
    },
    {
      "path": "src/kimi_cli/cli",
      "name": "cli",
      "entry_point": "__init__.py",
      "description": "模块化 CLI 命令系统，包含 info、mcp、term、acp 等子命令",
      "key_files": [
        "__init__.py",
        "__main__.py",
        "info.py",
        "mcp.py",
        "toad.py"
      ],
      "test_coverage": true,
      "scan_status": "updated",
      "last_updated": "2026-01-25 18:15",
      "subcommands": [
        {
          "name": "info",
          "description": "显示版本和协议信息",
          "features": ["--json 格式输出", "版本信息", "协议支持"]
        },
        {
          "name": "mcp",
          "description": "MCP 服务器配置管理",
          "features": ["add", "list", "remove", "test", "auth", "reset-auth"]
        },
        {
          "name": "term",
          "description": "启动 Toad TUI 终端界面",
          "features": ["Python 3.14+ 支持", "ACP 协议兼容"]
        },
        {
          "name": "acp",
          "description": "运行 ACP 服务器",
          "features": ["Agent Client Protocol", "编辑器集成"]
        }
      ]
    }
  ],
  "recent_changes": [
    {
      "timestamp": "2026-01-25 18:15:16",
      "type": "major_update",
      "description": "全面更新至 v0.87 - Monorepo 架构完善、模块化 CLI 重构、技能系统增强",
      "version": "0.87",
      "impact": "架构升级"
    },
    {
      "timestamp": "2026-01-21",
      "type": "feature_update",
      "description": "更新至 v0.82 - 视频上传支持、工作目录外文件操作、保留上下文大小配置",
      "version": "0.82",
      "impact": "功能增强"
    },
    {
      "timestamp": "2026-01-04",
      "type": "major_refactor",
      "description": "重大更新至 v0.72 - Python 3.14 支持、CLI 模块化、Toad TUI、技能系统、斜杠命令增强",
      "version": "0.72",
      "impact": "架构重构"
    }
  ],
  "scan_gaps": [
    {
      "module": "src/kimi_cli/deps",
      "reason": "外部依赖目录，按忽略规则跳过",
      "impact": "low",
      "status": "ignored"
    },
    {
      "module": "tests_local",
      "reason": "本地测试目录，按 .gitignore 规则跳过",
      "impact": "low",
      "status": "ignored"
    },
    {
      "module": ".venv",
      "reason": "虚拟环境目录，按 .gitignore 规则跳过",
      "impact": "low",
      "status": "ignored"
    }
  ],
  "key_discoveries": [
    {
      "feature": "Monorepo 架构",
      "description": "项目采用 uv workspace 管理的 Monorepo 架构，包含 kaos、kosong、kimi-code、kimi-sdk 四个独立包",
      "impact": "high",
      "packages": ["kaos", "kosong", "kimi-code", "kimi-sdk"],
      "status": "fully_analyzed"
    },
    {
      "feature": "模块化 CLI 重构",
      "description": "CLI 从单个 cli.py 重构为 cli/ 目录，包含独立的子命令模块（info、mcp、term、acp）",
      "impact": "high",
      "files": ["src/kimi_cli/cli/__init__.py", "src/kimi_cli/cli/info.py", "src/kimi_cli/cli/mcp.py", "src/kimi_cli/cli/toad.py"],
      "status": "fully_analyzed"
    },
    {
      "feature": "技能系统",
      "description": "支持 SKILL.md 技能发现和加载，兼容 Claude Code 技能格式",
      "impact": "medium",
      "files": ["src/kimi_cli/skill.py"],
      "status": "fully_analyzed"
    },
    {
      "feature": "Toad TUI 支持",
      "description": "新增 Toad TUI 终端界面，提供现代化的 TUI 体验，需要 Python 3.14+",
      "impact": "medium",
      "files": ["src/kimi_cli/cli/toad.py"],
      "status": "fully_analyzed"
    },
    {
      "feature": "Kaos 抽象层",
      "description": "文件系统和 shell 访问抽象层，支持本地和 SSH 远程访问",
      "impact": "high",
      "files": ["packages/kaos/src/kaos/__init__.py", "packages/kaos/src/kaos/local.py", "packages/kaos/src/kaos/ssh.py"],
      "status": "fully_analyzed"
    },
    {
      "feature": "Kosong LLM 抽象层",
      "description": "统一的 LLM 抽象层，支持多提供商和工具调用",
      "impact": "high",
      "files": ["packages/kosong/src/kosong/__init__.py", "packages/kosong/src/kosong/chat_provider/", "packages/kosong/src/kosong/tooling/"],
      "status": "fully_analyzed"
    },
    {
      "feature": "Wire 协议消息系统",
      "description": "基于广播队列的消息传递系统，支持消息合并和文件后端",
      "impact": "medium",
      "files": ["src/kimi_cli/wire/__init__.py", "src/kimi_cli/wire/types.py", "src/kimi_cli/wire/file.py"],
      "status": "fully_analyzed"
    }
  ],
  "architecture_insights": {
    "design_patterns": [
      "依赖注入模式",
      "策略模式（工具系统）",
      "观察者模式（消息系统）",
      "工厂模式（Agent 创建）",
      "广播模式（Wire 消息系统）",
      "抽象工厂模式（Kaos 后端）",
      "适配器模式（LLM 提供商）"
    ],
    "async_architecture": "全面基于 asyncio 的异步架构",
    "modular_design": "高度模块化设计，清晰的职责分离",
    "protocol_support": "多协议集成，支持外部扩展",
    "monorepo_structure": "uv workspace 管理的 Monorepo 架构",
    "layered_abstraction": "多层抽象设计（Kaos -> Kimi CLI -> Tools）"
  },
  "technology_stack": {
    "core": ["Python 3.12+", "asyncio", "Typer", "Kosong", "Pydantic"],
    "ui": ["Rich", "prompt-toolkit", "Pillow", "Toad"],
    "tools": ["ripgrepy", "trafilatura", "aiohttp", "fastmcp"],
    "development": ["uv", "pytest", "ruff", "pyright", "ty", "PyInstaller", "Nix", "prek"],
    "protocols": ["Agent Client Protocol", "Model Context Protocol", "Wire Protocol"],
    "monorepo_packages": ["kaos", "kosong", "kimi-code", "kimi-sdk"]
  },
  "quality_metrics": {
    "code_style": "ruff_formatting",
    "type_checking": "pyright_strict",
    "test_framework": "pytest_asyncio",
    "documentation_coverage": "100%",
    "async_compliance": "high",
    "modularization_score": "high",
    "monorepo_health": "excellent"
  },
  "ignored_patterns": [
    "__pycache__/**/*",
    "build/**/*",
    "dist/**/*",
    ".venv/**/*",
    "src/kimi_cli/deps/**/*",
    "tests_local/**/*",
    "*.egg-info/**/*",
    ".git/**/*",
    ".github/**/*",
    ".mypy_cache/**/*",
    ".spec-workflow/**/*",
    "result*",
    ".DS_Store",
    "uv.lock"
  ],
  "scan_results": {
    "files_successfully_scanned": 300,
    "files_skipped": 50,
    "scan_errors": 0,
    "truncated_sections": 0,
    "deep_analysis_completed": true,
    "monorepo_scan_completed": true
  },
  "documentation_status": {
    "root_documentation": "fully_updated",
    "module_documentation": "fully_updated",
    "navigation_breadcrumbs": "maintained",
    "mermaid_diagrams": "accurate",
    "coverage_reports": "current",
    "monorepo_documentation": "complete"
  },
  "next_steps": {
    "immediate_actions": [
      "保持 Monorepo 架构文档同步",
      "监控新版本更新"
    ],
    "recommended_improvements": [
      "增加 UI 模块的测试覆盖",
      "完善 utils 模块的单元测试",
      "考虑添加性能基准测试",
      "优化上下文压缩算法"
    ],
    "future_enhancements": [
      "扩展技能系统功能",
      "增强 MCP 工具集成生态",
      "探索更多 LLM 提供商集成",
      "优化 Wire 协议功能稳定性"
    ]
  },
  "truncated": false,
  "scan_completion_status": "full_monorepo_complete"
}
