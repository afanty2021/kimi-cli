# 安装与环境配置

<cite>
**本文档引用的文件**
- [README.md](file://README.md)
- [pyproject.toml](file://pyproject.toml)
- [Makefile](file://Makefile)
- [CONTRIBUTING.md](file://CONTRIBUTING.md)
- [kimi.spec](file://kimi.spec)
- [src/kimi_cli/cli.py](file://src/kimi_cli/cli.py)
- [src/kimi_cli/app.py](file://src/kimi_cli/app.py)
- [src/kimi_cli/config.py](file://src/kimi_cli/config.py)
- [src/kimi_cli/constant.py](file://src/kimi_cli/constant.py)
- [src/kimi_cli/deps/Makefile](file://src/kimi_cli/deps/Makefile)
- [uv.lock](file://uv.lock)
</cite>

## 目录
1. [简介](#简介)
2. [系统要求](#系统要求)
3. [安装步骤](#安装步骤)
4. [开发环境搭建](#开发环境搭建)
5. [常见问题解决](#常见问题解决)
6. [升级指南](#升级指南)
7. [依赖项详解](#依赖项详解)
8. [验证安装](#验证安装)
9. [故障排除](#故障排除)

## 简介

Kimi CLI 是一个基于 Python 的命令行智能代理工具，支持 Shell 模式、Zsh 集成、Agent 客户端协议（ACP）和 MCP 支持。本指南将详细说明如何通过 uv 工具全局安装 Kimi CLI，以及开发环境的完整搭建过程。

## 系统要求

### 前置条件

1. **Python 版本要求**
   - 必须安装 Python 3.13 或更高版本
   - 推荐使用最新稳定版 Python 3.13.x

2. **包管理器**
   - 需要安装 uv 包管理器（推荐）
   - uv 是 Kimi CLI 的官方推荐包管理工具

3. **操作系统支持**
   - macOS (Intel 和 Apple Silicon)
   - Linux (x86_64, ARM64)
   - Windows (Windows 10 及以上)

### macOS 安全机制注意事项

由于 macOS 的安全检查机制，首次运行 `kimi` 命令可能会出现 10 秒或更长时间的延迟。这是系统安全策略导致的正常现象。

## 安装步骤

### 步骤 1：安装 uv 包管理器

在开始安装 Kimi CLI 之前，需要先安装 uv 包管理器：

```bash
# 使用 curl 安装 uv
curl -LsSf https://astral.sh/uv/install.sh | sh

# 或者使用 Homebrew（macOS）
brew install uv

# 验证安装
uv --version
```

### 步骤 2：全局安装 Kimi CLI

使用 uv 工具进行全局安装：

```bash
# 全局安装 Kimi CLI（指定 Python 3.13）
uv tool install --python 3.13 kimi-cli

# 如果已经安装了 Python 3.13，默认情况下会自动选择
uv tool install kimi-cli
```

### 步骤 3：验证安装

安装完成后，验证 Kimi CLI 是否正确安装：

```bash
# 查看版本信息
kimi --version

# 获取帮助信息
kimi --help
```

**章节来源**
- [README.md](file://README.md#L26-L47)
- [pyproject.toml](file://pyproject.toml#L6)

## 开发环境搭建

### 准备开发环境

对于希望参与 Kimi CLI 开发的用户，可以按照以下步骤搭建开发环境：

```bash
# 克隆项目仓库
git clone https://github.com/MoonshotAI/kimi-cli.git
cd kimi-cli

# 准备开发环境（同步依赖）
make prepare
```

### 开发命令详解

项目提供了完整的 Makefile 构建系统，包含以下常用开发命令：

| 命令 | 功能描述 |
|------|----------|
| `make prepare` | 同步依赖（使用锁定版本） |
| `make format` | 格式化 Python 源代码 |
| `make check` | 运行代码检查和类型检查 |
| `make test` | 运行测试套件 |
| `make build` | 使用 PyInstaller 构建独立可执行文件 |
| `make ai-test` | 使用 Kimi CLI 运行测试套件 |
| `make help` | 显示所有可用的 make 目标 |

### 运行开发版本

在开发环境中运行 Kimi CLI：

```bash
# 直接运行
uv run kimi

# 在打印模式下运行
uv run kimi --print

# 使用特定工作目录
uv run kimi --work-dir ./my-project
```

**章节来源**
- [README.md](file://README.md#L135-L157)
- [Makefile](file://Makefile#L1-L37)
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L9)

## 常见问题解决

### 问题 1：Python 版本不兼容

**症状**：安装时提示 Python 版本过低

**解决方案**：
```bash
# 检查当前 Python 版本
python3 --version

# 升级到 Python 3.13+
# macOS 用户可以使用 pyenv
pyenv install 3.13.0
pyenv global 3.13.0

# 或者使用 Homebrew
brew install python@3.13
```

### 问题 2：uv 安装失败

**症状**：安装 uv 时出现网络错误或权限问题

**解决方案**：
```bash
# 尝试不同的安装方式
pip install uv

# 或者手动下载安装
curl -LsSf https://astral.sh/uv/latest/install.sh | sh -s -- --force
```

### 问题 3：macOS 安全机制导致的延迟

**症状**：首次运行 `kimi` 命令响应缓慢

**解决方案**：
- 这是 macOS 系统的安全机制导致的正常现象
- 等待 10-30 秒后命令将正常响应
- 后续运行不会出现延迟

**章节来源**
- [README.md](file://README.md#L38-L40)

## 升级指南

### 升级 Kimi CLI

使用 uv 工具升级到最新版本：

```bash
# 升级到最新版本
uv tool upgrade kimi-cli --no-cache
```

### 验证升级

```bash
# 检查当前版本
kimi --version

# 查看更新日志
kimi --help
```

### 回滚版本

如果遇到问题，可以回滚到之前的版本：

```bash
# 列出已安装的版本
uv tool list

# 回滚到特定版本
uv tool install --python 3.13 kimi-cli@0.53
```

**章节来源**
- [README.md](file://README.md#L41-L47)

## 依赖项详解

### 核心依赖项

根据 `pyproject.toml` 文件，Kimi CLI 的核心依赖项包括：

| 依赖项 | 版本 | 用途 |
|--------|------|------|
| `agent-client-protocol` | 0.6.3 | 支持 Agent 客户端协议 |
| `aiohttp` | 3.13.2 | 异步 HTTP 客户端 |
| `typer` | 0.20.0 | 命令行界面框架 |
| `pyyaml` | 6.0.3 | YAML 文件处理 |
| `rich` | 14.2.0 | 终端美化显示 |
| `pydantic` | 2.12.4 | 数据验证和设置管理 |

### 开发依赖项

开发环境额外需要的依赖项：

| 依赖项 | 版本 | 用途 |
|--------|------|------|
| `pytest` | >=9.0.1 | 测试框架 |
| `ruff` | >=0.14.4 | 代码格式化和检查 |
| `pyright` | >=1.1.407 | 类型检查 |
| `inline-snapshot` | >=0.31.1 | 测试快照管理 |

### 平台特定依赖

项目还包含了针对不同平台的优化依赖：

- **macOS**: 支持 Apple Silicon (ARM64) 和 Intel 处理器
- **Linux**: 支持 x86_64、ARM64 架构
- **Windows**: 支持 Win32 和 AMD64 架构

**章节来源**
- [pyproject.toml](file://pyproject.toml#L7-L36)
- [uv.lock](file://uv.lock#L1-L672)

## 验证安装

### 基础功能验证

```bash
# 1. 检查版本信息
kimi --version

# 2. 查看帮助信息
kimi --help

# 3. 运行基本命令
kimi --print "Hello, Kimi CLI!"
```

### 配置验证

首次运行时，Kimi CLI 会自动创建配置文件：

```bash
# 检查配置文件位置
ls ~/.config/kimi/

# 查看默认配置
cat ~/.config/kimi/config.json
```

### 环境变量验证

检查必要的环境变量：

```bash
# 检查 Python 路径
which python3

# 检查 uv 路径
which uv

# 检查 Kimi CLI 路径
which kimi
```

## 故障排除

### 常见错误及解决方案

#### 错误 1：找不到 kimi 命令

**症状**：`command not found: kimi`

**解决方案**：
```bash
# 检查 uv 工具是否正确安装
uv tool list

# 重新安装
uv tool install --python 3.13 kimi-cli

# 检查 PATH 设置
echo $PATH
```

#### 错误 2：权限不足

**症状**：安装或运行时出现权限错误

**解决方案**：
```bash
# 检查文件权限
ls -la $(which kimi)

# 修复权限（如果需要）
chmod +x $(which kimi)
```

#### 错误 3：网络连接问题

**症状**：安装过程中网络超时

**解决方案**：
```bash
# 使用国内镜像源
uv tool install --python 3.13 kimi-cli --index-url https://pypi.tuna.tsinghua.edu.cn/simple

# 或者设置代理
export HTTP_PROXY=http://proxy:port
export HTTPS_PROXY=http://proxy:port
```

### 调试技巧

启用调试模式获取更多信息：

```bash
# 启用详细输出
kimi --verbose --debug

# 查看日志文件
tail -f ~/.config/kimi/logs/kimi.log
```

### 获取帮助

如果遇到无法解决的问题：

1. **查看官方文档**：访问项目 GitHub 页面
2. **提交 Issue**：在 GitHub 上报告问题
3. **社区支持**：加入相关技术社区讨论

**章节来源**
- [src/kimi_cli/cli.py](file://src/kimi_cli/cli.py#L1-L358)
- [src/kimi_cli/app.py](file://src/kimi_cli/app.py#L1-L217)

## 总结

通过本指南，您应该能够：

1. 成功安装和配置 Kimi CLI
2. 理解开发环境的搭建流程
3. 掌握常用的开发和维护命令
4. 解决常见的安装和运行问题

Kimi CLI 作为一个功能强大的命令行智能代理工具，为开发者提供了丰富的功能和灵活的配置选项。随着项目的持续发展，建议定期关注更新并保持工具的最新状态。