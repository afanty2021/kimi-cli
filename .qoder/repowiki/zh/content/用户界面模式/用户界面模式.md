# ç”¨æˆ·ç•Œé¢æ¨¡å¼

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**
- [src/kimi_cli/ui/shell/__init__.py](file://src/kimi_cli/ui/shell/__init__.py)
- [src/kimi_cli/ui/shell/console.py](file://src/kimi_cli/ui/shell/console.py)
- [src/kimi_cli/ui/shell/prompt.py](file://src/kimi_cli/ui/shell/prompt.py)
- [src/kimi_cli/ui/shell/keyboard.py](file://src/kimi_cli/ui/shell/keyboard.py)
- [src/kimi_cli/ui/shell/metacmd.py](file://src/kimi_cli/ui/shell/metacmd.py)
- [src/kimi_cli/ui/shell/visualize.py](file://src/kimi_cli/ui/shell/visualize.py)
- [src/kimi_cli/ui/print/__init__.py](file://src/kimi_cli/ui/print/__init__.py)
- [src/kimi_cli/ui/print/visualize.py](file://src/kimi_cli/ui/print/visualize.py)
- [src/kimi_cli/ui/acp/__init__.py](file://src/kimi_cli/ui/acp/__init__.py)
- [src/kimi_cli/ui/wire/__init__.py](file://src/kimi_cli/ui/wire/__init__.py)
- [src/kimi_cli/ui/wire/jsonrpc.py](file://src/kimi_cli/ui/wire/jsonrpc.py)
- [src/kimi_cli/ui/wire/README.md](file://src/kimi_cli/ui/wire/README.md)
- [src/kimi_cli/ui/CLAUDE.md](file://src/kimi_cli/ui/CLAUDE.md)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
5. [Shellæ¨¡å¼è¯¦è§£](#shellæ¨¡å¼è¯¦è§£)
6. [Printæ¨¡å¼è¯¦è§£](#printæ¨¡å¼è¯¦è§£)
7. [ACPæ¨¡å¼è¯¦è§£](#acpæ¨¡å¼è¯¦è§£)
8. [Wireæ¨¡å¼è¯¦è§£](#wireæ¨¡å¼è¯¦è§£)
9. [UIè®¾è®¡åŸåˆ™](#uiè®¾è®¡åŸåˆ™)
10. [é”™è¯¯å¤„ç†æœºåˆ¶](#é”™è¯¯å¤„ç†æœºåˆ¶)
11. [æ€»ç»“](#æ€»ç»“)

## ç®€ä»‹

Kimi CLIæä¾›äº†å››ç§ä¸åŒçš„ç”¨æˆ·ç•Œé¢æ¨¡å¼ï¼Œæ¯ç§æ¨¡å¼éƒ½é’ˆå¯¹ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯è¿›è¡Œäº†ä¼˜åŒ–ã€‚è¿™äº›æ¨¡å¼åŒ…æ‹¬äº¤äº’å¼çš„Shellæ¨¡å¼ã€éäº¤äº’å¼çš„Printæ¨¡å¼ã€æœåŠ¡å™¨é›†æˆçš„ACPæ¨¡å¼ï¼Œä»¥åŠå®éªŒæ€§çš„Wireåè®®æ¨¡å¼ã€‚æ¯ä¸ªæ¨¡å¼éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ç‰¹æ€§å’Œé€‚ç”¨åœºæ™¯ï¼Œä¸ºç”¨æˆ·æä¾›äº†çµæ´»çš„äº¤äº’é€‰æ‹©ã€‚

## é¡¹ç›®ç»“æ„

Kimi CLIçš„UIæ¨¡å—é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ¯ä¸ªç•Œé¢æ¨¡å¼éƒ½æœ‰ç‹¬ç«‹çš„å®ç°ï¼š

```mermaid
graph TD
A[UIæ¨¡å—] --> B[Shellæ¨¡å¼]
A --> C[Printæ¨¡å¼]
A --> D[ACPæ¨¡å¼]
A --> E[Wireæ¨¡å¼]
B --> B1[console.py - æ§åˆ¶å°é…ç½®]
B --> B2[prompt.py - æç¤ºç¬¦å¤„ç†]
B --> B3[keyboard.py - é”®ç›˜äº‹ä»¶]
B --> B4[metacmd.py - å…ƒå‘½ä»¤]
B --> B5[visualize.py - å¯è§†åŒ–æ¸²æŸ“]
C --> C1[visualize.py - å†…å®¹æ¸²æŸ“]
D --> D1[__init__.py - ACPåè®®å®ç°]
E --> E1[jsonrpc.py - JSON-RPCåè®®]
E --> E2[README.md - åè®®æ–‡æ¡£]
```

**å›¾è¡¨æ¥æº**
- [src/kimi_cli/ui/shell/__init__.py](file://src/kimi_cli/ui/shell/__init__.py#L1-L320)
- [src/kimi_cli/ui/print/__init__.py](file://src/kimi_cli/ui/print/__init__.py#L1-L127)
- [src/kimi_cli/ui/acp/__init__.py](file://src/kimi_cli/ui/acp/__init__.py#L1-L473)
- [src/kimi_cli/ui/wire/__init__.py](file://src/kimi_cli/ui/wire/__init__.py#L1-L343)

**ç« èŠ‚æ¥æº**
- [src/kimi_cli/ui/CLAUDE.md](file://src/kimi_cli/ui/CLAUDE.md#L1-L298)

## æ ¸å¿ƒç»„ä»¶

UIæ¨¡å—çš„æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ï¼š

### Shellæ¨¡å¼ç»„ä»¶
- **Console**: Richæ§åˆ¶å°é…ç½®å’Œæ ·å¼ç®¡ç†
- **Prompt**: å‘½ä»¤æç¤ºç¬¦å’Œè¾“å…¥å¤„ç†
- **Keyboard**: é”®ç›˜äº‹ä»¶å¤„ç†å’Œå¿«æ·é”®ç»‘å®š
- **MetaCommand**: å…ƒå‘½ä»¤å¤„ç†å™¨
- **Visualize**: å¯è§†åŒ–æ¸²æŸ“å¼•æ“

### Printæ¨¡å¼ç»„ä»¶  
- **Visualize**: æ‰“å°æ¨¡å¼çš„å†…å®¹æ¸²æŸ“å™¨

### ACPæ¨¡å¼ç»„ä»¶
- **ACPAgent**: ACPåè®®ä»£ç†å®ç°
- **ACPServer**: ACPæœåŠ¡å™¨å®ç°

### Wireæ¨¡å¼ç»„ä»¶
- **WireServer**: Wireåè®®æœåŠ¡å™¨
- **JSONRPC**: JSON-RPCåè®®å®ç°

**ç« èŠ‚æ¥æº**
- [src/kimi_cli/ui/shell/__init__.py](file://src/kimi_cli/ui/shell/__init__.py#L28-L320)
- [src/kimi_cli/ui/print/__init__.py](file://src/kimi_cli/ui/print/__init__.py#L21-L127)
- [src/kimi_cli/ui/acp/__init__.py](file://src/kimi_cli/ui/acp/__init__.py#L74-L473)
- [src/kimi_cli/ui/wire/__init__.py](file://src/kimi_cli/ui/wire/__init__.py#L35-L343)

## æ¶æ„æ¦‚è§ˆ

Kimi CLIçš„UIæ¶æ„é‡‡ç”¨åˆ†å±‚è®¾è®¡ï¼Œæ”¯æŒå¤šç§äº¤äº’æ¨¡å¼ï¼š

```mermaid
graph TB
subgraph "ç”¨æˆ·æ¥å£å±‚"
A[Shellæ¨¡å¼]
B[Printæ¨¡å¼]
C[ACPæ¨¡å¼]
D[Wireæ¨¡å¼]
end
subgraph "æ ¸å¿ƒæœåŠ¡å±‚"
E[Soulè¿è¡Œæ—¶]
F[æ¶ˆæ¯å¤„ç†]
G[çŠ¶æ€ç®¡ç†]
end
subgraph "æ¸²æŸ“å±‚"
H[Richæ¸²æŸ“å™¨]
I[Markdownå¤„ç†å™¨]
J[è¿›åº¦æ˜¾ç¤º]
end
subgraph "é€šä¿¡å±‚"
K[STDIOæµ]
L[JSON-RPC]
M[ACPåè®®]
end
A --> E
B --> E
C --> E
D --> E
E --> F
F --> G
A --> H
B --> I
C --> H
D --> H
A --> K
B --> K
C --> M
D --> L
```

**å›¾è¡¨æ¥æº**
- [src/kimi_cli/ui/shell/__init__.py](file://src/kimi_cli/ui/shell/__init__.py#L28-L92)
- [src/kimi_cli/ui/print/__init__.py](file://src/kimi_cli/ui/print/__init__.py#L21-L101)
- [src/kimi_cli/ui/acp/__init__.py](file://src/kimi_cli/ui/acp/__init__.py#L447-L473)
- [src/kimi_cli/ui/wire/__init__.py](file://src/kimi_cli/ui/wire/__init__.py#L114-L137)

## Shellæ¨¡å¼è¯¦è§£

Shellæ¨¡å¼æ˜¯Kimi CLIçš„ä¸»è¦äº¤äº’æ–¹å¼ï¼Œæä¾›ç±»ä¼¼ç»ˆç«¯çš„ç”¨æˆ·ä½“éªŒã€‚

### æ ¸å¿ƒç‰¹æ€§

#### 1. æ¨¡å¼åˆ‡æ¢æœºåˆ¶
Shellæ¨¡å¼æ”¯æŒä¸¤ç§ä¸»è¦æ¨¡å¼ä¹‹é—´çš„æ— ç¼åˆ‡æ¢ï¼š

```mermaid
stateDiagram-v2
[*] --> AgentMode
AgentMode --> ShellMode : Ctrl-X
ShellMode --> AgentMode : Ctrl-X
AgentMode --> ThinkingMode : Tab
ThinkingMode --> AgentMode : Tab
note right of AgentMode : âœ¨ ç”¨æˆ·æç¤ºç¬¦<br/>AIåŠ©æ‰‹äº¤äº’
note right of ShellMode : $ ç”¨æˆ·æç¤ºç¬¦<br/>ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ
note right of ThinkingMode : ğŸ’« æ€è€ƒæ¨¡å¼<br/>è¯¦ç»†æ¨ç†è¿‡ç¨‹
```

**å›¾è¡¨æ¥æº**
- [src/kimi_cli/ui/shell/prompt.py](file://src/kimi_cli/ui/shell/prompt.py#L386-L395)
- [src/kimi_cli/ui/shell/prompt.py](file://src/kimi_cli/ui/shell/prompt.py#L557-L567)

#### 2. é”®ç›˜äº¤äº’ç³»ç»Ÿ
Shellæ¨¡å¼æä¾›äº†ä¸°å¯Œçš„é”®ç›˜å¿«æ·é”®æ”¯æŒï¼š

| å¿«æ·é”®ç»„åˆ | åŠŸèƒ½æè¿° | è§¦å‘æ¡ä»¶ |
|-----------|----------|----------|
| `Ctrl-X` | åˆ‡æ¢Agent/Shellæ¨¡å¼ | ä»»ä½•æ—¶å€™ |
| `Tab` | åˆ‡æ¢æ€è€ƒæ¨¡å¼ | Agentæ¨¡å¼ä¸”æ”¯æŒæ€è€ƒèƒ½åŠ› |
| `Ctrl-J`/`Alt-Enter` | æ’å…¥æ–°è¡Œ | è¾“å…¥è¿‡ç¨‹ä¸­ |
| `Ctrl-V` | ç²˜è´´å†…å®¹ | æ”¯æŒå‰ªè´´æ¿æ—¶ |
| `Ctrl-D` | é€€å‡ºç¨‹åº | é»˜è®¤è¡Œä¸º |

#### 3. è‡ªåŠ¨è¡¥å…¨ç³»ç»Ÿ
Shellæ¨¡å¼é›†æˆäº†æ™ºèƒ½è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼š

```mermaid
flowchart TD
A[ç”¨æˆ·è¾“å…¥] --> B{è§¦å‘è¡¥å…¨?}
B --> |æ˜¯| C[MetaCommandCompleter]
B --> |æ˜¯| D[FileMentionCompleter]
B --> |å¦| E[æ™®é€šè¾“å…¥]
C --> F[æ˜¾ç¤ºå¯ç”¨å‘½ä»¤]
D --> G[æ˜¾ç¤ºæ–‡ä»¶è·¯å¾„]
F --> H[ç”¨æˆ·é€‰æ‹©]
G --> H
H --> I[æ’å…¥è¡¥å…¨ç»“æœ]
E --> J[ç»§ç»­è¾“å…¥]
```

**å›¾è¡¨æ¥æº**
- [src/kimi_cli/ui/shell/prompt.py](file://src/kimi_cli/ui/shell/prompt.py#L57-L94)
- [src/kimi_cli/ui/shell/prompt.py](file://src/kimi_cli/ui/shell/prompt.py#L96-L339)

#### 4. å…ƒå‘½ä»¤ç³»ç»Ÿ
Shellæ¨¡å¼æ”¯æŒä¸°å¯Œçš„å…ƒå‘½ä»¤ï¼š

| å…ƒå‘½ä»¤ | åŠŸèƒ½æè¿° | æ˜¯å¦ä»…é™KimiSoul |
|--------|----------|------------------|
| `/help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ | å¦ |
| `/setup` | è®¾ç½®å‘å¯¼ | å¦ |
| `/exit` | é€€å‡ºç¨‹åº | å¦ |
| `/clear` | æ¸…å± | å¦ |
| `/history` | æ˜¾ç¤ºå†å²è®°å½• | å¦ |
| `/mode` | åˆ‡æ¢æ¨¡å¼ | å¦ |
| `/init` | åˆ†æä»£ç åº“ | æ˜¯ |
| `/clear` | æ¸…é™¤ä¸Šä¸‹æ–‡ | æ˜¯ |
| `/compact` | å‹ç¼©ä¸Šä¸‹æ–‡ | æ˜¯ |
| `/yolo` | å¯ç”¨YOLOæ¨¡å¼ | æ˜¯ |

**ç« èŠ‚æ¥æº**
- [src/kimi_cli/ui/shell/__init__.py](file://src/kimi_cli/ui/shell/__init__.py#L53-L91)
- [src/kimi_cli/ui/shell/metacmd.py](file://src/kimi_cli/ui/shell/metacmd.py#L138-L276)

### è§†è§‰åé¦ˆç³»ç»Ÿ

Shellæ¨¡å¼æä¾›äº†ä¸°å¯Œçš„è§†è§‰åé¦ˆï¼š

#### 1. å®æ—¶çŠ¶æ€æ˜¾ç¤º
```mermaid
graph LR
A[çŠ¶æ€æ ] --> B[æ—¶é—´æ˜¾ç¤º]
A --> C[æ¨¡å¼æŒ‡ç¤º]
A --> D[æ€è€ƒçŠ¶æ€]
A --> E[ä¸Šä¸‹æ–‡ä½¿ç”¨ç‡]
A --> F[å¿«æ·é”®æç¤º]
```

#### 2. å·¥å…·è°ƒç”¨å¯è§†åŒ–
å·¥å…·è°ƒç”¨è¿‡ç¨‹ä»¥æ ‘çŠ¶ç»“æ„å±•ç¤ºï¼š

```mermaid
graph TD
A[å·¥å…·è°ƒç”¨å¼€å§‹] --> B[æ˜¾ç¤ºå·¥å…·åç§°]
B --> C[å‚æ•°è§£æè¿›åº¦]
C --> D[å­å·¥å…·è°ƒç”¨]
D --> E[ç»“æœæ±‡æ€»]
E --> F[å®Œæˆæ˜¾ç¤º]
D --> D1[å­å·¥å…·1]
D --> D2[å­å·¥å…·2]
D --> D3[å­å·¥å…·N]
```

**å›¾è¡¨æ¥æº**
- [src/kimi_cli/ui/shell/visualize.py](file://src/kimi_cli/ui/shell/visualize.py#L80-L209)

#### 3. å®¡æ‰¹è¯·æ±‚å¤„ç†
å½“éœ€è¦ç”¨æˆ·æˆæƒæ—¶ï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºå®¡æ‰¹é¢æ¿ï¼š

```mermaid
sequenceDiagram
participant U as ç”¨æˆ·
participant S as Shell
participant A as AIåŠ©æ‰‹
A->>S : è¯·æ±‚å®¡æ‰¹
S->>U : æ˜¾ç¤ºå®¡æ‰¹é¢æ¿
U->>S : é€‰æ‹©æ“ä½œ
S->>A : è¿”å›å®¡æ‰¹ç»“æœ
A->>S : ç»§ç»­æ‰§è¡Œ
```

**å›¾è¡¨æ¥æº**
- [src/kimi_cli/ui/shell/visualize.py](file://src/kimi_cli/ui/shell/visualize.py#L212-L262)

**ç« èŠ‚æ¥æº**
- [src/kimi_cli/ui/shell/visualize.py](file://src/kimi_cli/ui/shell/visualize.py#L40-L566)

## Printæ¨¡å¼è¯¦è§£

Printæ¨¡å¼ä¸“ä¸ºéäº¤äº’å¼æ‰¹å¤„ç†ä»»åŠ¡è®¾è®¡ï¼Œé€‚åˆè„šæœ¬é›†æˆå’Œè‡ªåŠ¨åŒ–åœºæ™¯ã€‚

### æ ¸å¿ƒç‰¹æ€§

#### 1. è¾“å‡ºæ ¼å¼æ”¯æŒ
Printæ¨¡å¼æ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼ï¼š

| æ ¼å¼ | æè¿° | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `text` | çº¯æ–‡æœ¬è¾“å‡º | ç›´æ¥æŸ¥çœ‹ç»“æœ |
| `stream-json` | æµå¼JSONè¾“å‡º | å®æ—¶å¤„ç† |

#### 2. è¾“å…¥å¤„ç†æœºåˆ¶
```mermaid
flowchart TD
A[å¼€å§‹] --> B{æ£€æŸ¥è¾“å…¥æº}
B --> |å‘½ä»¤è¡Œå‚æ•°| C[ä½¿ç”¨å‘½ä»¤è¡Œè¾“å…¥]
B --> |æ ‡å‡†è¾“å…¥| D{æ˜¯å¦ä¸ºTTY?}
D --> |æ˜¯| E[ç­‰å¾…ç”¨æˆ·è¾“å…¥]
D --> |å¦| F[è¯»å–æ ‡å‡†è¾“å…¥]
C --> G[è¿è¡ŒSoul]
E --> G
F --> G
G --> H[å¯è§†åŒ–è¾“å‡º]
H --> I[ç»“æŸ]
```

**å›¾è¡¨æ¥æº**
- [src/kimi_cli/ui/print/__init__.py](file://src/kimi_cli/ui/print/__init__.py#L44-L82)

#### 3. æµå¼JSONå¤„ç†
å¯¹äº`stream-json`æ ¼å¼ï¼Œç³»ç»Ÿèƒ½å¤Ÿå¤„ç†è¿ç»­çš„JSONæ¶ˆæ¯æµï¼š

```mermaid
sequenceDiagram
participant C as å®¢æˆ·ç«¯
participant P as Printæ¨¡å¼
participant S as Soul
C->>P : å‘é€JSONæ¶ˆæ¯
P->>P : è§£ææ¶ˆæ¯
P->>S : å¤„ç†ç”¨æˆ·è¾“å…¥
S->>P : è¿”å›äº‹ä»¶æµ
P->>C : è¾“å‡ºJSONäº‹ä»¶
```

**å›¾è¡¨æ¥æº**
- [src/kimi_cli/ui/print/__init__.py](file://src/kimi_cli/ui/print/__init__.py#L103-L127)

### åº”ç”¨åœºæ™¯

Printæ¨¡å¼ç‰¹åˆ«é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š
- CI/CDæµæ°´çº¿é›†æˆ
- è‡ªåŠ¨åŒ–è„šæœ¬å¤„ç†
- æ‰¹é‡å¤„ç†ä»»åŠ¡
- ç³»ç»Ÿç›‘æ§å’Œæ—¥å¿—åˆ†æ

**ç« èŠ‚æ¥æº**
- [src/kimi_cli/ui/print/__init__.py](file://src/kimi_cli/ui/print/__init__.py#L21-L127)
- [src/kimi_cli/ui/print/visualize.py](file://src/kimi_cli/ui/print/visualize.py#L15-L130)

## ACPæ¨¡å¼è¯¦è§£

ACPï¼ˆAgent Client Protocolï¼‰æ¨¡å¼å®ç°äº†æ ‡å‡†åŒ–çš„ä»£ç†å®¢æˆ·ç«¯åè®®ï¼Œæ”¯æŒä¸å„ç§ç¼–è¾‘å™¨å’ŒIDEçš„é›†æˆã€‚

### åè®®ç‰¹æ€§

#### 1. åè®®èƒ½åŠ›å£°æ˜
ACPæœåŠ¡å™¨å£°æ˜äº†å…¶æ”¯æŒçš„èƒ½åŠ›ï¼š

```mermaid
graph TD
A[ACPæœåŠ¡å™¨] --> B[AgentCapabilities]
B --> C[loadSession: false]
B --> D[PromptCapabilities]
D --> E[embeddedContext: false]
D --> F[image: false]
D --> G[audio: false]
A --> H[è®¤è¯æ–¹æ³•]
H --> I[æ— è®¤è¯]
```

**å›¾è¡¨æ¥æº**
- [src/kimi_cli/ui/acp/__init__.py](file://src/kimi_cli/ui/acp/__init__.py#L90-L99)

#### 2. ä¼šè¯ç®¡ç†
ACPåè®®æ”¯æŒä¼šè¯ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š

```mermaid
sequenceDiagram
participant C as å®¢æˆ·ç«¯
participant S as ACPæœåŠ¡å™¨
participant A as AIåŠ©æ‰‹
C->>S : InitializeRequest
S->>C : InitializeResponse
C->>S : NewSessionRequest
S->>C : NewSessionResponse
C->>S : PromptRequest
S->>A : å¤„ç†æç¤º
A->>S : æµå¼å“åº”
S->>C : SessionUpdate
C->>S : CancelNotification
S->>A : å–æ¶ˆè¯·æ±‚
```

**å›¾è¡¨æ¥æº**
- [src/kimi_cli/ui/acp/__init__.py](file://src/kimi_cli/ui/acp/__init__.py#L105-L180)

#### 3. å·¥å…·è°ƒç”¨é›†æˆ
ACPæ¨¡å¼æ”¯æŒå¤æ‚çš„å·¥å…·è°ƒç”¨é“¾ï¼š

```mermaid
graph TD
A[å·¥å…·è°ƒç”¨å¼€å§‹] --> B[ToolCallStart]
B --> C[ToolCallProgress]
C --> D[å­å·¥å…·è°ƒç”¨]
D --> E[ToolCallProgress]
E --> F[ToolCallProgress]
F --> G[ToolCallProgress]
G --> H[ToolCallComplete]
D --> D1[å­å·¥å…·1]
D --> D2[å­å·¥å…·2]
D --> D3[å­å·¥å…·N]
```

**å›¾è¡¨æ¥æº**
- [src/kimi_cli/ui/acp/__init__.py](file://src/kimi_cli/ui/acp/__init__.py#L238-L326)

### ç¼–è¾‘å™¨é›†æˆé…ç½®

#### Zedç¼–è¾‘å™¨é…ç½®ç¤ºä¾‹
è¦åœ¨Zedä¸­ä½¿ç”¨Kimi CLIä½œä¸ºä»£ç†æœåŠ¡å™¨ï¼Œéœ€è¦æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```json
{
  "agent_servers": {
    "Kimi CLI": {
      "command": "kimi",
      "args": ["--acp"],
      "env": {}
    }
  }
}
```

#### æ”¯æŒçš„ç¼–è¾‘å™¨
- **Zed**: åŸç”Ÿæ”¯æŒï¼Œé€šè¿‡é…ç½®å³å¯ä½¿ç”¨
- **VS Code**: é€šè¿‡æ’ä»¶æ”¯æŒ
- **å…¶ä»–ç¼–è¾‘å™¨**: ä»»ä½•æ”¯æŒACPåè®®çš„ç¼–è¾‘å™¨

**ç« èŠ‚æ¥æº**
- [src/kimi_cli/ui/acp/__init__.py](file://src/kimi_cli/ui/acp/__init__.py#L74-L473)

## Wireæ¨¡å¼è¯¦è§£

Wireæ¨¡å¼æ˜¯ä¸€ä¸ªå®éªŒæ€§çš„åè®®ï¼Œæä¾›åŸºäºJSON-RPCçš„é€šä¿¡æ¥å£ã€‚

### åè®®è§„èŒƒ

#### 1. ä¼ è¾“å±‚
Wireåè®®ä½¿ç”¨æ ‡å‡†è¾“å…¥è¾“å‡ºè¿›è¡Œé€šä¿¡ï¼š

```mermaid
graph LR
A[å®¢æˆ·ç«¯] --> B[STDIOæµ]
B --> C[WireServer]
C --> D[STDIOæµ]
D --> E[å®¢æˆ·ç«¯]
B --> F[JSON-RPCè§£æå™¨]
F --> G[æ¶ˆæ¯è·¯ç”±å™¨]
G --> H[Soulè¿è¡Œæ—¶]
```

**å›¾è¡¨æ¥æº**
- [src/kimi_cli/ui/wire/__init__.py](file://src/kimi_cli/ui/wire/__init__.py#L114-L137)

#### 2. æ–¹æ³•è°ƒç”¨
Wireåè®®æ”¯æŒä»¥ä¸‹æ–¹æ³•ï¼š

| æ–¹æ³•å | è¯·æ±‚å‚æ•° | å“åº”ç±»å‹ | æè¿° |
|--------|----------|----------|------|
| `run` | `{"input": "prompt"}` | æˆåŠŸ/é”™è¯¯ | æ‰§è¡ŒAIä»»åŠ¡ |
| `interrupt` | `{}` | æˆåŠŸ/é”™è¯¯ | ä¸­æ–­å½“å‰ä»»åŠ¡ |

#### 3. äº‹ä»¶é€šçŸ¥
æœåŠ¡å™¨ä¼šå‘é€å„ç§äº‹ä»¶é€šçŸ¥ï¼š

```mermaid
graph TD
A[äº‹ä»¶ç±»å‹] --> B[step_begin]
A --> C[step_interrupted]
A --> D[compaction_begin]
A --> E[compaction_end]
A --> F[status_update]
A --> G[content_part]
A --> H[tool_call]
A --> I[tool_call_part]
A --> J[tool_result]
```

**å›¾è¡¨æ¥æº**
- [src/kimi_cli/ui/wire/README.md](file://src/kimi_cli/ui/wire/README.md#L51-L67)

### JSON-RPCå®ç°

Wireæ¨¡å¼ä½¿ç”¨æ ‡å‡†çš„JSON-RPC 2.0åè®®ï¼š

```mermaid
classDiagram
class JSONRPCRequest {
+string jsonrpc
+string method
+string id
+dict params
}
class JSONRPCSuccessResponse {
+string jsonrpc
+string id
+dict result
}
class JSONRPCErrorResponse {
+string jsonrpc
+string id
+JSONRPCErrorObject error
}
class JSONRPCErrorObject {
+int code
+string message
+Any data
}
JSONRPCSuccessResponse --> JSONRPCErrorObject
```

**å›¾è¡¨æ¥æº**
- [src/kimi_cli/ui/wire/jsonrpc.py](file://src/kimi_cli/ui/wire/jsonrpc.py#L16-L38)

### é”™è¯¯ç å®šä¹‰

| é”™è¯¯ç  | å«ä¹‰ | åœºæ™¯ |
|--------|------|------|
| -32000 | è¿è¡Œä¸­ | å½“å‰å·²æœ‰è¿è¡Œä¸­çš„ä»»åŠ¡ |
| -32001 | LLMæœªé…ç½® | AIæ¨¡å‹æœªæ­£ç¡®è®¾ç½® |
| -32002 | æä¾›å•†é”™è¯¯ | AIæœåŠ¡æä¾›å•†è¿”å›é”™è¯¯ |
| -32003 | ä¸æ”¯æŒçš„LLM | å½“å‰æ¨¡å‹ä¸æ”¯æŒæŸäº›åŠŸèƒ½ |
| -32099 | è¿è¡Œå¤±è´¥ | æœªçŸ¥å¼‚å¸¸å¯¼è‡´çš„è¿è¡Œå¤±è´¥ |

**ç« èŠ‚æ¥æº**
- [src/kimi_cli/ui/wire/__init__.py](file://src/kimi_cli/ui/wire/__init__.py#L35-L343)
- [src/kimi_cli/ui/wire/jsonrpc.py](file://src/kimi_cli/ui/wire/jsonrpc.py#L1-L51)
- [src/kimi_cli/ui/wire/README.md](file://src/kimi_cli/ui/wire/README.md#L1-L110)

## UIè®¾è®¡åŸåˆ™

åŸºäºCLAUDE.mdä¸­çš„è®¾è®¡åŸåˆ™ï¼ŒKimi CLIçš„UIè®¾è®¡éµå¾ªä»¥ä¸‹æ ¸å¿ƒç†å¿µï¼š

### 1. ç”¨æˆ·ä½“éªŒä¼˜å…ˆ
- **ç›´è§‚çš„ç•Œé¢**: æ¸…æ™°çš„çŠ¶æ€æŒ‡ç¤ºå’Œæ“ä½œåé¦ˆ
- **å¿«é€Ÿå“åº”**: æœ€å°åŒ–å»¶è¿Ÿï¼Œæä¾›å®æ—¶åé¦ˆ
- **ä¸€è‡´æ€§**: ç»Ÿä¸€çš„äº¤äº’æ¨¡å¼å’Œè§†è§‰é£æ ¼

### 2. å¯è®¿é—®æ€§è®¾è®¡
- **é”®ç›˜å¯¼èˆª**: å®Œæ•´çš„é”®ç›˜å¿«æ·é”®æ”¯æŒ
- **å±å¹•é˜…è¯»å™¨**: æ”¯æŒè¾…åŠ©æŠ€æœ¯
- **è‰²å½©å¯¹æ¯”**: é«˜å¯¹æ¯”åº¦çš„é¢œè‰²æ–¹æ¡ˆ

### 3. é”™è¯¯å¤„ç†ç­–ç•¥
```mermaid
flowchart TD
A[é”™è¯¯å‘ç”Ÿ] --> B{é”™è¯¯ç±»å‹}
B --> |ç½‘ç»œé”™è¯¯| C[é‡è¯•æœºåˆ¶]
B --> |è®¤è¯é”™è¯¯| D[é‡æ–°é…ç½®æç¤º]
B --> |æƒé™é”™è¯¯| E[æƒé™è¯´æ˜]
B --> |ç³»ç»Ÿé”™è¯¯| F[è¯¦ç»†æ—¥å¿—]
C --> G[ç”¨æˆ·ç¡®è®¤]
D --> H[å¼•å¯¼é…ç½®]
E --> I[æƒé™ç”³è¯·]
F --> J[æ•…éšœæ’é™¤æŒ‡å—]
```

### 4. æ¸è¿›å¼æŠ«éœ²
- **åŸºç¡€åŠŸèƒ½**: æ–°ç”¨æˆ·å¯ä»¥ç«‹å³ä¸Šæ‰‹
- **é«˜çº§ç‰¹æ€§**: æœ‰ç»éªŒçš„ç”¨æˆ·å¯ä»¥æ¢ç´¢
- **é…ç½®é€‰é¡¹**: æ¸è¿›å¼æš´éœ²é«˜çº§è®¾ç½®

**ç« èŠ‚æ¥æº**
- [src/kimi_cli/ui/CLAUDE.md](file://src/kimi_cli/ui/CLAUDE.md#L1-L298)

## é”™è¯¯å¤„ç†æœºåˆ¶

Kimi CLIçš„UIå±‚å®ç°äº†å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

### 1. å¼‚å¸¸åˆ†ç±»å¤„ç†
```mermaid
graph TD
A[å¼‚å¸¸ç±»å‹] --> B[LLMç›¸å…³]
A --> C[ç½‘ç»œç›¸å…³]
A --> D[ç³»ç»Ÿç›¸å…³]
A --> E[ç”¨æˆ·ç›¸å…³]
B --> B1[LLMNotSet]
B --> B2[LLMNotSupported]
B --> B3[ChatProviderError]
C --> C1[APIStatusError]
C --> C2[è¿æ¥è¶…æ—¶]
D --> D1[æ–‡ä»¶æƒé™]
D --> D2[ç£ç›˜ç©ºé—´]
E --> E1[ç”¨æˆ·å–æ¶ˆ]
E --> E2[è¾“å…¥éªŒè¯]
```

### 2. é”™è¯¯æ¢å¤ç­–ç•¥
- **è‡ªåŠ¨é‡è¯•**: å¯¹äºä¸´æ—¶æ€§é”™è¯¯
- **é™çº§å¤„ç†**: åŠŸèƒ½ä¸å¯ç”¨æ—¶çš„æ›¿ä»£æ–¹æ¡ˆ
- **ç”¨æˆ·å¼•å¯¼**: æ¸…æ™°çš„é”™è¯¯è¯´æ˜å’Œè§£å†³å»ºè®®

### 3. æ—¥å¿—è®°å½•
- **ç»“æ„åŒ–æ—¥å¿—**: ä¾¿äºåˆ†æå’Œè°ƒè¯•
- **æ•æ„Ÿä¿¡æ¯è¿‡æ»¤**: é¿å…æ³„éœ²ä¸ªäººä¿¡æ¯
- **åˆ†çº§æ—¥å¿—**: ä¸åŒä¸¥é‡çº§åˆ«çš„æ—¥å¿—åˆ†ç¦»

**ç« èŠ‚æ¥æº**
- [src/kimi_cli/ui/shell/__init__.py](file://src/kimi_cli/ui/shell/__init__.py#L160-L229)
- [src/kimi_cli/ui/print/__init__.py](file://src/kimi_cli/ui/print/__init__.py#L78-L98)

## æ€»ç»“

Kimi CLIçš„ç”¨æˆ·ç•Œé¢æ¨¡å¼ç³»ç»Ÿæä¾›äº†ä¸°å¯Œè€Œçµæ´»çš„äº¤äº’é€‰æ‹©ï¼š

### æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | Shellæ¨¡å¼ | Printæ¨¡å¼ | ACPæ¨¡å¼ | Wireæ¨¡å¼ |
|------|-----------|-----------|---------|----------|
| äº¤äº’æ€§ | å®Œå…¨äº¤äº’ | éäº¤äº’ | äº¤äº’ | äº¤äº’ |
| é€‚ç”¨åœºæ™¯ | æ—¥å¸¸ä½¿ç”¨ | æ‰¹å¤„ç† | ç¼–è¾‘å™¨é›†æˆ | å¼€å‘å·¥å…· |
| é…ç½®å¤æ‚åº¦ | ä¸­ç­‰ | ä½ | ä¸­ç­‰ | é«˜ |
| æ€§èƒ½å¼€é”€ | ä¸­ç­‰ | ä½ | ä¸­ç­‰ | ä¸­ç­‰ |
| æ‰©å±•æ€§ | é«˜ | ä¸­ç­‰ | é«˜ | é«˜ |

### è®¾è®¡ä¼˜åŠ¿

1. **æ¨¡å—åŒ–æ¶æ„**: æ¯ä¸ªæ¨¡å¼ç‹¬ç«‹å®ç°ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
2. **ç»Ÿä¸€æ¥å£**: åº•å±‚Soulè¿è¡Œæ—¶ä¿æŒä¸€è‡´çš„æ¥å£
3. **æ¸è¿›å¢å¼º**: ä»ç®€å•åˆ°å¤æ‚çš„åŠŸèƒ½é€’è¿›
4. **æ ‡å‡†åŒ–åè®®**: ACPå’ŒWireæ¨¡å¼ç¬¦åˆè¡Œä¸šæ ‡å‡†

### æœªæ¥å‘å±•æ–¹å‘

- **æ›´å¤šç¼–è¾‘å™¨æ”¯æŒ**: æ‰©å±•ACPåè®®æ”¯æŒèŒƒå›´
- **æ€§èƒ½ä¼˜åŒ–**: å‡å°‘å»¶è¿Ÿï¼Œæå‡å“åº”é€Ÿåº¦
- **åŠŸèƒ½å¢å¼º**: æ·»åŠ æ›´å¤šäº¤äº’ç‰¹æ€§
- **åè®®å®Œå–„**: Wireåè®®çš„æ ‡å‡†åŒ–å’Œç¨³å®šåŒ–

é€šè¿‡è¿™å››ç§ä¸åŒçš„ç”¨æˆ·ç•Œé¢æ¨¡å¼ï¼ŒKimi CLIèƒ½å¤Ÿæ»¡è¶³ä»æ—¥å¸¸å¼€å‘åˆ°ä¸“ä¸šé›†æˆçš„å„ç§éœ€æ±‚ï¼Œä¸ºç”¨æˆ·æä¾›æœ€ä½³çš„AIè¾…åŠ©å¼€å‘ä½“éªŒã€‚